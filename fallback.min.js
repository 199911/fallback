/*
*    fallback.js v0.1
*
*    @author Salvatore Garbesi <sal@dolox.com>
*    @url https://github.com/sgarbesi/fallback.js
*    @copyright 2013 Dolox Inc.
*/

fallback={callback:null,ready_invoke:!0,ready_functions:[],head:document.getElementsByTagName("head")[0],libraries:{},libraries_count:0,loaded:{},loaded_count:0,broken:{},broken_count:0,initialize:function(){var a,b;for(a in this.libraries)b=this.libraries[a],b instanceof Array||(this.libraries[a]=b=[b]),this.libraries_count++,this.spawn(a,b[0],0)},completed:function(){this.libraries_count==this.loaded_count+this.broken_count&&(this.ready_invoke&&this.ready_invocation(),this.callback(this.loaded,
this.broken))},error:function(a,b){b=parseInt(b);this.broken[a]||(this.broken[a]=[]);this.broken[a][this.broken[a].length]=this.libraries[a][b];b<this.libraries[a].length-1?this.spawn(a,this.libraries[a][b+1],b+1):this.broken_count++;this.completed()},load:function(a,b){var c={};this.ready_invoke=!0;if(b){if(!1===b.ready_invoke&&(this.ready_invoke=b.ready_invoke),!b.callback||b.callback&&"[object Function]"!==c.toString.call(b.callback))b.callback=function(){}}else b={callback:function(){}};this.callback=
b.callback;this.libraries=a;this.initialize()},ready:function(a){this.ready_functions[fallback.length]=a},ready_invocation:function(){var a;if(this.ready_functions)for(a in this.ready_functions)this.ready_functions[a](this.loaded,this.broken)},spawn:function(a,b,c){var d=document.createElement("script");d.src=b;d.onload=function(){fallback.success(a,c)};d.onerror=function(){fallback.error(a,c)};this.head.appendChild(d)},success:function(a,b){this.loaded[a]=this.libraries[a][b];this.loaded_count++;
this.completed()}};window.fallback=fallback;